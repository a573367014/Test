import { get } from 'lodash';
import Promise from 'bluebird';
// import getVm from './get-vm';
import loader from '@gaoding/editor-utils/loader';
import { createCanvas } from '@gaoding/editor-utils/canvas';
import { loadImage } from './loader';

export const CLASS_PREFIX = 'svg-export__';
export function checkLoaded(model) {
    if (model.$loaded) {
        // 需要渲染时间
        return Promise.delay(10);
    }

    return Promise.delay(100).then(() => {
        return checkLoaded(model);
    });
}

export function replaceUrl(html) {
    const urls = [];
    html.replace(/background-image:\s*url\(([^"\\)]+)\)/g, (v, url) => {
        if (url && !urls.includes(url)) {
            urls.push(url);
        }
    });

    return Promise.map(
        urls.filter((url) => {
            const isBase64 = url && url.includes(';base64');
            return !isBase64;
        }),
        (url) => {
            return loader.loadImage(url).then((img) => {
                const cavs = createCanvas(img.width, img.height);
                cavs.getContext('2d').drawImage(img, 0, 0);

                let ext = url.split('.').pop();
                ext = ['jpg', 'jpeg', 'gif'].includes(ext) ? ext : 'png';
                return cavs.toDataURL(`image/${ext}`);
            });
        },
    ).then((dataUrls) => {
        dataUrls.forEach((item, i) => {
            html = html.replace(new RegExp(urls[i], 'g'), item);
        });

        return html;
    });
}

// 多个相同的backgroundImage转class样式复用
export const effectClassMap = new Map();
export function setEffectClassMap(effect) {
    if (
        get(effect, 'filling.enable') === false ||
        ![1, 'image'].includes(get(effect, 'filling.type')) ||
        !get(effect, 'filling.imageContent.image')
    )
        return;

    const url = effect.filling.imageContent.image;

    if (url && url.length < 200 && !effectClassMap.get(url)) {
        const id = Math.random().toString().replace('.', '');
        const className = `backgroundImage_${id}`;
        effectClassMap.set(url, {
            url,
            className,
            styleStr: `.${className}{background-image: url(${url});}`,
        });
    }
}

export function createStyle() {
    return (
        '<style>' +
        [
            `
        .${CLASS_PREFIX}element {will-change: transform;position: absolute; left: 0; top: 0;transform-origin: 50% 50%;}
        .${CLASS_PREFIX}element-position {width: 100%;height: 100%;position: absolute;top: 0;left: 0; }
        .${CLASS_PREFIX}element-content {box-sizing: border-box; width: 100%;height: 100%;font-size: 0;white-space: nowrap;}
        .${CLASS_PREFIX}element-before { display: inline-block;vertical-align: middle;}
        .${CLASS_PREFIX}element-main {word-wrap: break-word;white-space: normal;display: inline-block;outline: 0;position: relative;}

        .${CLASS_PREFIX}element-main p, 
        .${CLASS_PREFIX}element-main div, 
        .${CLASS_PREFIX}element-main ol, 
        .${CLASS_PREFIX}element-main ul, 
        .${CLASS_PREFIX}element-main li {padding: 0;margin: 0;}
        .middle-v {writing-mode: vertical-rl}
        `,
            `.is-list .${CLASS_PREFIX}element-main>ol>li,.is-list .${CLASS_PREFIX}element-main>ul>li,.is-list .${CLASS_PREFIX}element-main>div,.is-list .${CLASS_PREFIX}element-main>p,.is-list .${CLASS_PREFIX}element-main>span{display:list-item;list-style:none}.is-list .${CLASS_PREFIX}element-main>ol>li::before,.is-list .${CLASS_PREFIX}element-main>ul>li::before,.is-list .${CLASS_PREFIX}element-main>div::before,.is-list .${CLASS_PREFIX}element-main>p::before,.is-list .${CLASS_PREFIX}element-main>span::before{letter-spacing:0;box-sizing:border-box;position:absolute;left:0;margin:0;white-space:nowrap;padding-left:.2em}.middle-v.is-list .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list .${CLASS_PREFIX}element-main>div,.middle-v.is-list .${CLASS_PREFIX}element-main>p,.middle-v.is-list .${CLASS_PREFIX}element-main>span{margin-left:0!important}.middle-v.is-list .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list .${CLASS_PREFIX}element-main>span::before{margin-left:0;padding-left:0;padding-top:.2em;width:auto;top:0;left:auto}.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>div,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>p,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>span{position:relative}.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list.is-fox .${CLASS_PREFIX}element-main>span::before{right:0;transform:translateY(-100%)}.is-list--disc .${CLASS_PREFIX}element-main>ol>li::before,.is-list--disc .${CLASS_PREFIX}element-main>ul>li::before,.is-list--disc .${CLASS_PREFIX}element-main>div::before,.is-list--disc .${CLASS_PREFIX}element-main>p::before,.is-list--disc .${CLASS_PREFIX}element-main>span::before{padding-left:.5em}.middle-v.is-list.is-list--disc .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list.is-list--disc .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list.is-list--disc .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list.is-list--disc .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list.is-list--disc .${CLASS_PREFIX}element-main>span::before{padding-top:.5em}.is-list--disc .${CLASS_PREFIX}element-main{counter-reset:list-count}.is-list--disc .${CLASS_PREFIX}element-main>ol>li,.is-list--disc .${CLASS_PREFIX}element-main>ul>li,.is-list--disc .${CLASS_PREFIX}element-main>div,.is-list--disc .${CLASS_PREFIX}element-main>p,.is-list--disc .${CLASS_PREFIX}element-main>span{margin-left:1.3em}.is-list--disc .${CLASS_PREFIX}element-main>ol>li::before,.is-list--disc .${CLASS_PREFIX}element-main>ul>li::before,.is-list--disc .${CLASS_PREFIX}element-main>div::before,.is-list--disc .${CLASS_PREFIX}element-main>p::before,.is-list--disc .${CLASS_PREFIX}element-main>span::before{counter-increment:list-count;content:counter(list-count,disc) '';width:1.3em}.middle-v.is-list--disc .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>div,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>p,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>span{margin-top:1.3em}.middle-v.is-list--disc .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--disc .${CLASS_PREFIX}element-main>span::before{height:1.3em}.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ol>li,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ul>li,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>div,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>p,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>span{margin-left:1.3em}.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ol>li::before,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ul>li::before,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>div::before,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>p::before,.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>span::before{width:1.3em}.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>div,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}
element-main>p,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>span{margin-top:1.3em}.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--digit-2.is-list--disc .${CLASS_PREFIX}element-main>span::before{height:1.3em}.is-list--decimal .${CLASS_PREFIX}element-main{counter-reset:list-count}.is-list--decimal .${CLASS_PREFIX}element-main>ol>li,.is-list--decimal .${CLASS_PREFIX}element-main>ul>li,.is-list--decimal .${CLASS_PREFIX}element-main>div,.is-list--decimal .${CLASS_PREFIX}element-main>p,.is-list--decimal .${CLASS_PREFIX}element-main>span{margin-left:1.3em}.is-list--decimal .${CLASS_PREFIX}element-main>ol>li::before,.is-list--decimal .${CLASS_PREFIX}element-main>ul>li::before,.is-list--decimal .${CLASS_PREFIX}element-main>div::before,.is-list--decimal .${CLASS_PREFIX}element-main>p::before,.is-list--decimal .${CLASS_PREFIX}element-main>span::before{counter-increment:list-count;content:counter(list-count,decimal) '.';width:1.3em}.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>div,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>p,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>span{margin-top:1.3em}.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--decimal .${CLASS_PREFIX}element-main>span::before{height:1.3em}.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ol>li,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ul>li,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>div,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>p,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>span{margin-left:1.8em}.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ol>li::before,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ul>li::before,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>div::before,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>p::before,.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>span::before{width:1.8em}.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>div,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>p,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>span{margin-top:1.8em}.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--digit-2.is-list--decimal .${CLASS_PREFIX}element-main>span::before{height:1.8em}.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main{counter-reset:list-count}.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span{margin-left:1.8em}.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li::before,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li::before,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div::before,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p::before,.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span::before{counter-increment:list-count;content:counter(list-count,decimal-leading-zero) '.';width:1.8em}.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span{margin-top:1.8em}.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}
element-main>ul>li::before,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span::before{height:1.8em}.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span{margin-left:1.8em}.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li::before,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li::before,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div::before,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p::before,.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span::before{width:1.8em}.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span{margin-top:1.8em}.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--digit-2.is-list--decimal-leading-zero .${CLASS_PREFIX}element-main>span::before{height:1.8em}.is-list--lower-alpha .${CLASS_PREFIX}element-main{counter-reset:list-count}.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li,.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li,.is-list--lower-alpha .${CLASS_PREFIX}element-main>div,.is-list--lower-alpha .${CLASS_PREFIX}element-main>p,.is-list--lower-alpha .${CLASS_PREFIX}element-main>span{margin-left:1.3em}.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li::before,.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li::before,.is-list--lower-alpha .${CLASS_PREFIX}element-main>div::before,.is-list--lower-alpha .${CLASS_PREFIX}element-main>p::before,.is-list--lower-alpha .${CLASS_PREFIX}element-main>span::before{counter-increment:list-count;content:counter(list-count,lower-alpha) '.';width:1.3em}.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>div,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>p,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>span{margin-top:1.3em}.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--lower-alpha .${CLASS_PREFIX}element-main>span::before{height:1.3em}.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>div,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>p,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>span{margin-left:1.8em}.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li::before,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li::before,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>div::before,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>p::before,.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>span::before{width:1.8em}.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>div,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>p,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>span{margin-top:1.8em}.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}
element-main>ul>li::before,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--digit-2.is-list--lower-alpha .${CLASS_PREFIX}element-main>span::before{height:1.8em}.is-list--upper-alpha .${CLASS_PREFIX}element-main{counter-reset:list-count}.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li,.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li,.is-list--upper-alpha .${CLASS_PREFIX}element-main>div,.is-list--upper-alpha .${CLASS_PREFIX}element-main>p,.is-list--upper-alpha .${CLASS_PREFIX}element-main>span{margin-left:1.3em}.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li::before,.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li::before,.is-list--upper-alpha .${CLASS_PREFIX}element-main>div::before,.is-list--upper-alpha .${CLASS_PREFIX}element-main>p::before,.is-list--upper-alpha .${CLASS_PREFIX}element-main>span::before{counter-increment:list-count;content:counter(list-count,upper-alpha) '.';width:1.3em}.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>div,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>p,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>span{margin-top:1.3em}.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--upper-alpha .${CLASS_PREFIX}element-main>span::before{height:1.3em}.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>div,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>p,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>span{margin-left:1.8em}.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li::before,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li::before,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>div::before,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>p::before,.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>span::before{width:1.8em}.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>div,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>p,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>span{margin-top:1.8em}.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--digit-2.is-list--upper-alpha .${CLASS_PREFIX}element-main>span::before{height:1.8em}.is-list--cjk-ideographic .${CLASS_PREFIX}element-main{counter-reset:list-count}.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span{margin-left:1.8em}.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li::before,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li::before,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div::before,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p::before,.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span::before{counter-increment:list-count;content:counter(list-count,cjk-ideographic) '、';width:1.8em}.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span{margin-top:1.8em}.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}
element-main>p::before,.middle-v.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span::before{height:1.8em}.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span{margin-left:3em}.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li::before,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li::before,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div::before,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p::before,.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span::before{width:3em}.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span{margin-top:3em}.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ol>li::before,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>ul>li::before,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>div::before,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>p::before,.middle-v.is-list--digit-2.is-list--cjk-ideographic .${CLASS_PREFIX}element-main>span::before{height:3em}`,
        ].join('') +
        '</style>'
    );
}

export function isSupportCross() {
    const svgString =
        '<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><foreignObject></foreignObject></svg>';
    const url = 'data:image/svg+xml;charset=utf8,' + encodeURIComponent(svgString);
    const cvs = createCanvas(1, 1);

    return loadImage(url)
        .then((img) => {
            const ctx = cvs.getContext('2d');
            ctx.drawImage(img, 0, 0);
            ctx.getImageData(0, 0, 1, 1);

            return true;
        })
        .catch((e) => {
            console.log(e);
            return false;
        });
}
